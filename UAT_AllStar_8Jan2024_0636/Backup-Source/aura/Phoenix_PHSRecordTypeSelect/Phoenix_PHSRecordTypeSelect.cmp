<aura:component controller="Phoenix_PHSControllerClass" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickAction,lightning:actionOverride" access="global" >
    <aura:attribute name="Name" type="String" />
    <aura:attribute name="StartDate" type="Date" />
    <aura:attribute name="EndDate" type="Date" />
    <aura:attribute name="filetype" type="List" default="['.odt','.wps','.rtf','.msg','.pps','.png','.war','.pjp','.apng','.gif','.pjp','.pjpeg','.jfif','.webp','.avif','.jpg','.jpeg','.pdf','.xlsm','.xlsx','.xlsb','.CSV','.xltx','.html', '.htt', '.mht',' .svg', '.swf', '.thtml','.xhtml','.txt','.odp','.pptx','.ppt','.docx','.doc','.docm','.dotx','.dot','.zip','.zipx','.tar','.xls']"/>
    <aura:attribute name="selectedRecordTypeId" type="String" />
    <aura:attribute name="selectedRecordTypeName" type="String" />
    <aura:attribute name="mapOfRecordType" type="Map" />
    <aura:attribute name="linesList" type="Phoenix_PHS_Price_Change_Line__c[]" />
      <aura:attribute name="linesList1" type="Phoenix_PHS_Price_Change_Line__c[]" />
    <aura:attribute name="duplicateLinesList" type="Phoenix_PHS_Price_Change_Line__c[]" />
    <aura:attribute name="updateList" type="Phoenix_PHS_Price_Change_Line__c[]" />
    <aura:attribute name="UnfilteredData" type="Phoenix_PHS_Price_Change_Line__c[]" />  
    <aura:attribute name="productList" type="Product2[]" />
    <aura:attribute name="filter" type="String" />  
    <aura:attribute name="disableSave" type="boolean" />
    <aura:attribute name="disableChangeLineSave" type="boolean" />
    <aura:attribute name="disableEdit" type="boolean" />
    <aura:attribute name="disableChangeLineSubmit" type="boolean" />
    <aura:attribute name="isProvisional" type="String" default="Provisional PHS Price" />
    <aura:attribute name="isQuarterly" type="String" default="Quarterly PHS Price" />
    <aura:attribute name="listOfSelectedProducts" type="list" />
    <aura:attribute name="selectedRecordId" type="String" />
    <aura:attribute name="contractLookupReadOnly" type="String" />
    <aura:attribute name="showSubmitModal" type="boolean" />
    <aura:attribute name="ApprovalStatus" type="String" default="Draft" />
    <aura:attribute name="AccountId" type="String" />
    <aura:attribute name="ProvisionalRecordTypeId" type="String" />
    <aura:attribute name="QuarterlyRecordTypeId" type="String" />
    <aura:attribute name="ApexusContractId" type="String" />
    <aura:attribute name="data" type="Object" />
    <aura:attribute name="searchText" type="String" />
    <aura:attribute name="filteredData" type="Phoenix_PHS_Price_Change_Line__c[]" />
    <aura:attribute name="isCreate" type="boolean" />
    <aura:attribute name="isNewRowAdded" type="boolean" default="false" />
    <aura:attribute name="disableSaveLines" type="boolean" />
    <aura:attribute name="disableSubmit" type="boolean" />
    
    <aura:attribute name="listOfRecordType" type="String" />
    <aura:attribute name="pageReference" type="Object"/>
    
    <aura:attribute name="disableExportImportBtn" type="boolean" default="true" />
    
    <lightning:navigation aura:id="navService"/>  
    <aura:attribute name="recordId" type="String" access="public" />
    <aura:attribute name="isSaved" type="boolean" default="false" />
    <aura:attribute name="fileUpload" type="boolean" default="false" />
    <aura:attribute name="showImportModal" type="boolean" default="false" />
    <aura:attribute name="fileList" type="List"  />
    
    <aura:attribute name="options" type="List" default="[
                                                        {'label': 'All', 'value': 'All'},
                                                        {'label': 'Yes', 'value': 'Yes'},
                                                        {'label': 'No', 'value': 'No'},
                                                        ]"/>
    
    <!-- New pagination attributes  -->
    <aura:attribute name="currentPageNumber" type="Integer" default="1"/>
    <aura:attribute name="pageSize" type="Integer" default="10"/>
    <aura:attribute name="totalPages" type="Integer" default="0"/>
    <aura:attribute name="pageList" type="List"/>
    
    <aura:attribute name="wrap" type="Object" description="To hold all objects" />
    <aura:attribute name="isError" type="Boolean" default="false" />
    <aura:attribute name="showSpinner" type="Boolean" default="false" />
    <aura:attribute name="errorMessage" type="String" />
    <aura:attribute access="public" name="formFactor" type="String" default="{!$Browser.formFactor}"/>
    <aura:attribute access="public" name="isIpad" type="String" default="{!$Browser.isIPad}"/>
    <aura:attribute access="public" name="isTablet" type="String" default="{!$Browser.isTablet}"/>
    
    
 <!-- Attributes that can be set while component calling-->
    <aura:attribute name="objectName" type="string" default="" required="true" />
    <aura:attribute name="fieldName" type="string" default="" required="true" />
    <aura:attribute name="value" type="String" default="" description="To pre-populate a value" />
    <aura:attribute name="recordCount" type="string" default="5" description="Records visible at once"/>
    <aura:attribute name="iconName" type="string" default="standard:drafts" description="complete icon name eg. standard:account" />
    <aura:attribute name="label" type="string" default="" description="Label will be displayed above input Box" />
    <aura:attribute name="placeholder" type="string" default="Select Contract" description="placeholder for input Box" />
 
    <!-- Internal Use Attributes -->
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name="searchString"   type="string" access="private" default="" description="String to search"/>
    <aura:attribute name="selectedRecord" type="Object" access="private" default="" description="selected Record Details" />
    <aura:attribute name="recordsList" type="List" access="private" description="List of Records having data" />
    <aura:attribute name="recordsListDuplicates" type="List" access="private" description="List of Records having data(duplicate of recordsList)" />
    <aura:attribute name="message"   type="String" access="private" default="" />
    
    <aura:attribute name="documentId" type="String" />
    
    <aura:attribute type="Boolean" name="sortAsc" />
    <aura:attribute type="String" name="sortField" default="ProductName__c" />
    <aura:attribute name="arrowDirection" type="string" default="arrowup" description="Use for change arrow sign direction on header based on click"/>
    <aura:attribute name="loaded" type="Boolean" default="false" />
    <aura:attribute name="saveSpinnerLoad" type="boolean" default="false" />
    <aura:attribute name="deletePHSLine" type="String" />
    <aura:attribute name="changeTo"
                    type="String" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:handler name="oSelectedRecordEvent" event="c:selectedsObjectRecordEvent" action="{!c.handleComponentEvent}"/>
    <aura:handler name="DeleteRowEvt" event="c:DeleteRowEvt" action="{!c.removeDeletedRow}"/>
    <aura:handler name="AddRowEvt" event="c:AddNewRowEvt" action="{!c.addNewRow}"/>
    <aura:handler name="onchange" 
                  event="l_lookup:OnChange" 
                  action="{!c.handleContractChange}"/>	
    <aura:handler name="WACChangeEvent" event="c:WACValueChangeEvent"
        action="{!c.disableSaveButton}"/>
    
    <aura:if isTrue="{!v.loaded}">
        <lightning:spinner alternativeText="Loading" />
    </aura:if>
    <div class="slds-box slds-theme_default slds-m-top_small" id="top">
        <lightning:messages />
        <lightning:recordEditForm aura:id="editForm" recordId="{!v.recordId}" objectApiName="Phoenix_PHS_Price_Change__c" onsuccess="{!c.handleSuccess}">
            <aura:if isTrue="{!(v.selectedRecordTypeId == v.ProvisionalRecordTypeId)}">
                <div class="slds-p-around_small slds-align_absolute-center" role="banner">
                    <h1 class="slds-modal__title slds-hyphenate slds-text-heading--medium">
                        <aura:if isTrue="{!v.isCreate}">
                            New {!v.isProvisional}
                            <aura:set attribute="else">
                                Edit {!v.isProvisional}
                            </aura:set>
                        </aura:if>
                    </h1>
                </div>
            </aura:if>
            <aura:if isTrue="{!(v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
                <div class="slds-p-around_small slds-align_absolute-center" role="banner">
                    <h1 class="slds-modal__title slds-hyphenate slds-text-heading--medium">
                        <aura:if isTrue="{!v.isCreate}">
                            New {!v.isQuarterly}
                            <aura:set attribute="else">
                                Edit {!v.isQuarterly}
                            </aura:set>
                        </aura:if>
                    </h1>
                </div>
            </aura:if>
            <div class="slds-grid">
                <div class="slds-col slds-size_1-of-2 slds-p-left_x-large slds-p-right_x-large">
                    <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                        <lightning:inputField fieldName="Phoenix_PHS_Price_Change_Name__c" value="{!v.Name}" disabled="{!v.disableSave}" required="true" />
                        <lightning:inputField fieldName="Phoenix_Account__c" value="{!v.AccountId}" disabled="true" required="true" />
                        <div class="slds-hide">
                            <lightning:inputField fieldName="RecordTypeId" value="{!v.selectedRecordTypeId}" disabled="{!v.disableSave}" />
                        </div>
                        <aura:if isTrue="{!(v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
                            <lightning:inputField fieldName="Phoenix_Price_Start_Date__c" value="{!v.StartDate}" disabled="{!v.disableSave}" required="true" />
                        </aura:if>
                        <aura:set attribute="else">
                            <lightning:inputField fieldName="Phoenix_PHS_Price_Change_Name__c" value="{!v.Name}" disabled="true" required="true" />
                            <lightning:inputField fieldName="Phoenix_Account__c" value="{!v.AccountId}" disabled="true" required="true" />
                            <div class="slds-hide">
                                <lightning:inputField fieldName="RecordTypeId" value="{!v.selectedRecordTypeId}" disabled="true" />
                            </div>
                            <aura:if isTrue="{!(v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
                                <lightning:inputField fieldName="Phoenix_Price_Start_Date__c" value="{!v.StartDate}" disabled="true" required="true" />
                            </aura:if>
                        </aura:set>
                    </aura:if>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-left_x-large slds-p-right_x-large">
                    <div class="slds-hide">
                        <lightning:inputField fieldName="Phoenix_Contract__c" value="{!v.selectedRecordId}" disabled="{!v.disableSave}" />
                    </div>
                    <div style="margin-bottom: 8px; padding: 0px 4px;">
                        <l_lookup:Lookup label="Contract" aura:id="contractLookup" objectType="Phoenix_Contract__c" 
                                         selectedRecordId="{!v.selectedRecordId}" 
                                         setTo="{!v.changeTo}"
                                         readOnly="{!v.contractLookupReadOnly}"
                                         queryCondition="{! 'Phoenix_Customer__r.Id=\'' + v.AccountId + '\''}"
                                         isRequired="true"
                                         />
                    </div>
                    <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                        <lightning:inputField fieldName="Phoenix_Record_Type__c" value="{!v.selectedRecordTypeName}" disabled="true" required="true" />
                        <aura:if isTrue="{!(v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
                            <lightning:inputField fieldName="Phoenix_Price_End_Date__c" value="{!v.EndDate}" disabled="{!v.disableSave}" required="true" />
                        </aura:if>
                        <aura:set attribute="else">
                            <div class="slds-hide">
                                <lightning:inputField fieldName="Phoenix_Contract__c" value="{!v.selectedRecordId}" disabled="true" />
                            </div>
                            <lightning:inputField fieldName="Phoenix_Record_Type__c" value="{!v.selectedRecordTypeName}" disabled="true" required="true" />
                            <aura:if isTrue="{!(v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
                                <lightning:inputField fieldName="Phoenix_Price_End_Date__c" value="{!v.EndDate}" disabled="true" required="true" />
                            </aura:if>
                        </aura:set>
                    </aura:if>
                </div>
            </div>
            <div class="slds-p-left_x-large slds-p-right_x-large">
                <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                    <lightning:inputField fieldName="Phoenix_PHS_Price_Change_Description__c" disabled="{!v.disableSave}" />
                    <aura:set attribute="else">
                        <lightning:inputField fieldName="Phoenix_PHS_Price_Change_Description__c" disabled="true" />
                    </aura:set>
                </aura:if>
            </div>
            <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                <lightning:button class="slds-m-top_small" variant="neutral" label="Back" onclick="{!c.backToSObject}" />
                <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                    <lightning:button class="slds-m-top_small" variant="brand" type="button" name="Save" label="Save" onclick="{!c.savePriceChange}" disabled="{!v.disableSave}"/>
                    <lightning:button class="slds-m-top_small" variant="brand" type="submit" name="Edit" label="Edit" disabled="{!v.disableEdit}" onclick="{!c.enableEdit}" />
                    <aura:set attribute="else">
                        <lightning:button class="slds-m-top_small" variant="brand" type="button" name="Save" label="Save" disabled="true"/>
                        <lightning:button class="slds-m-top_small" variant="brand" type="submit" name="Edit" label="Edit" disabled="true" />
                    </aura:set>
                </aura:if>
            </div>
        </lightning:recordEditForm>
    </div>
    <aura:if isTrue="{!and(v.isSaved,v.selectedRecordTypeId == v.ProvisionalRecordTypeId)}">
        <lightning:card>
            <p class="slds-modal__title slds-hyphenate slds-text-heading--small" style="padding: 8px 0px 0px 32px;">
                Number of records: {!v.linesList.length}/{!v.duplicateLinesList.length}
            </p>
            <div aura:id="mainDiv" style="max-height:460px;overflow:auto;margin-top:10px;" class=" slds-m-right_small slds-m-left_small">
                <div role="region" aria-labelledby="HeadersCol" tabindex="0" class="rowheaders">
                    <table aura:id="LineTable" class="customtable slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                        <thead>
                            <tr>
                                <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                                    <th scope="col" class="slds-truncate slds-cell-wrap" style="text-align: center;">
                                        <lightning:button variant="neutral" iconName="utility:add" iconPosition="left" onclick="{!c.addRow}" />
                                    </th>
                                </aura:if>
                                <th scope="col" class="slds-cell-wrap">
                                    <div class="slds-truncate">Product Name</div>
                                </th>
                                <th scope="col" class="slds-cell-wrap">
                                    <div class="slds-truncate">Material Code</div>
                                </th>
                                <th scope="col" class="slds-cell-wrap">
                                    <div class="slds-truncate">NDC-11</div>
                                </th>
                                <th scope="col" class="slds-cell-wrap">
                                    <div class="slds-truncate">Provisional PHS Price</div>
                                </th>
                                <th scope="col" class="slds-cell-wrap">
                                    <div class="slds-truncate">Price Start Date</div>
                                </th>
                                <th scope="col" class="slds-truncate slds-cell-wrap">
                                    <div class="slds-truncate">Price End Date</div>
                                </th>
                                <th scope="col" class="slds-truncate slds-cell-wrap">
                                    <div class="slds-truncate">Submitter Remarks</div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <aura:iteration items="{!v.linesList}" var="item" indexVar="index">
                                <c:Phoenix_ProvisionalPHSPriceChild ApprovalStatus="{!v.ApprovalStatus}" lineInstance="{!item}" rowIndex="{!index}" recordId="{!v.recordId}" productList="{!v.productList}" productListDuplicates="{!v.productList}"/>
                            </aura:iteration>
                        </tbody>
                    </table>
                </div>
                <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                    <lightning:button class="slds-m-top_medium" variant="neutral" label="Back" onclick="{!c.backToRecordDetail}"  />
                    <lightning:button class="slds-m-top_medium" variant="brand" type="Button" label="Save" onclick="{!c.Save}" disabled="{!or(or(v.linesList.length == 0, v.ApprovalStatus != 'Draft'),v.disableSaveLines )}" />
                    <aura:if isTrue="{!and(and(v.ApprovalStatus=='Draft',v.linesList1.length > 0), v.disableSubmit)}">
                        <lightning:button class="slds-m-top_medium" label="Submit For Approval" variant="brand" onclick="{!c.openSubmitModal}" />
                    </aura:if>
                </div>
                <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                    <lightning:button class="slds-m-top_medium" variant="brand" type="Button" label="Attach File" onclick="{!c.showUploadFile}" />
                </div>
        </div>
            <aura:if isTrue="{!v.fileUpload}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <!-- ###### MODAL BOX HEADER Start ######-->
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close"
                                                  onclick="{! c.closeModal }"
                                                  alternativeText="close"
                                                  variant="bare-inverse"
                                                  class="slds-modal__close"/>
                            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Upload Files</h2>
                        </header>
                        <!--###### MODAL BOX BODY Part Start######-->
                        <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                            <lightning:fileUpload label=""
                                                  variant="label-hidden"
                                                  name="fileUploader"
                                                  multiple="true"
                                                  accept="{!v.filetype}"
                                                  recordId="{!v.recordId}"
                                                  disabled="{!v.ApprovalStatus != 'Draft'}"
                                                  onuploadfinished="{!c.handleUploadFinished}" class="hideSpan"/>
                            <b><h2 style="font-size:15px;padding-bottom:10px;">List of Attachments ({!v.fileList.length})</h2></b>
                            <div class="container desktop forceContentFilePicker" style="width: 100%; display: flex; background-color: var(--lwc-colorBackgroundAlt,rgb(255, 255, 255));">
                                <!--div class="slds-border_left" ></div-->
                                <div class="rightPanel" style="float:right;width:100%;overflow-y: visible;" >
                                    <div class="searchResultsContainer multiAttach"   style="overflow: auto; clear: both; padding-right: 0;">
                                        <ul style="list-style:none;padding-left:40px;margin:0px;">
                                            
                                            <aura:iteration items="{!v.fileList}" var="file" indexVar="itemIndex">
                                                <li class="slds-var-p-horizontal_medium slds-var-p-vertical_xx-small forceContentVirtualRelatedListStencil forceRecordLayout" style="{!if(itemIndex==(v.fileList.length-1),'border-top:var(--lwc-borderWidthThin,1px) solid var(--lwc-colorBorderSeparatorAlt,rgb(221, 219, 218));height: auto; margin: 0; padding: 0; list-style: none; font-weight: var(--lwc-fontWeightRegular,400); font-size: var(--lwc-fontSizeMedium,0.8125rem);border-bottom:1px solid #dddbda;','border-top:var(--lwc-borderWidthThin,1px) solid var(--lwc-colorBorderSeparatorAlt,rgb(221, 219, 218));height: auto; margin: 0; padding: 0; list-style: none; font-weight: var(--lwc-fontWeightRegular,400); font-size: var(--lwc-fontSizeMedium,0.8125rem);')}" >
                                                    <div class="filerow" style="padding: var(--lwc-spacingXxSmall,0.25rem) 0 var(--lwc-spacingXxSmall,0.25rem) var(--lwc-spacingMedium,1rem);display: flex; table-layout: fixed; width: 100%;padding-bottom:8px;">
                                                        <div class="slds-size_12-of-12 slds-grid slds-nowrap">
                                                            <p  data-name="{!file.Id}" style="cursor:pointer;">
                                                                <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                                                                    <a  name="{!file.Id}" onclick="{!c.deleteAttachment}">
                                                                        <lightning:icon iconName="utility:delete" iconPosition="left" alternativeText="delete" size="x-small" />
                                                                    </a>
                                                                </aura:if>
                                                                <!-- <lightning:button class="customBIcon"
                                                                                          iconName="action:delete" iconPosition="left"
                                                                                          onclick="{!c.deleteAttachment }"
                                                                                          name="{!file.Id}"  />-->&nbsp; 
                                                                <a href="{!'/'+file.Id}"
                                                                   target="_blank"  >{!itemIndex+1}.&nbsp;{!file.Title} </a>   
                                                            </p>
                                                        </div>
                                                    </div>
                                                </li>
                                            </aura:iteration>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--###### MODAL BOX FOOTER Part Start ######-->
                        <footer class="slds-modal__footer">
                            <lightning:button variant="brand" label="Close"
                                              onclick="{!c.closeModal}" />
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>
            </lightning:card>
    </aura:if>
    <aura:if isTrue="{!and(v.isSaved,v.selectedRecordTypeId == v.QuarterlyRecordTypeId)}">
        <lightning:card>
            <div class="slds-grid">
                <div class="slds-col slds-size_1-of-2 slds-p-left_x-large slds-p-right_x-large slds-p-top_large">
                    <div class="slds-grid">
                        <div class="slds-col slds-size_3-of-4">
                            <span onkeypress="{!c.onKeyCheck}" >
                                <lightning:input value="{!v.searchText}" type="search"
                                                 variant="label-hidden" placeholder="Search with Product Name, Material Code and NDC-11"
                                                 aura:id="SearchBox" label="Product Name" onchange="{!c.onInputSearchChange}"
                                                 />
                            </span>
                        </div>
                        <div class="slds-col slds-size_1-of-4 slds-p-left_x-small">
                            <lightning:button variant="brand" type="Button" label="Search" onclick="{!c.onsearch}" />
                        </div>
                    </div>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-p-left_x-large slds-p-right_x-large">
                    <lightning:combobox name="progress" label="Filter by Apexus Sub-Ceiling Price Change Required" value="All" placeholder="Filter by Apexus Sub-Ceiling Price Change Required" options="{! v.options }" onchange="{! c.handleChange }"/>
                </div>
            </div>
            <p class="slds-modal__title slds-hyphenate slds-text-heading--small" style="padding: 8px 0px 0px 32px;">
                Number of records: {!v.data.length}/{!v.duplicateLinesList.length}
            </p>
            <div aura:id="mainDiv" style="max-height:460px;overflow:auto;margin-top:10px;" class=" slds-m-right_small slds-m-left_small">
                <aura:if isTrue="{!v.saveSpinnerLoad}">
                    <lightning:spinner alternativeText="Loading" />
                </aura:if>
                <div role="region" aria-labelledby="HeadersCol" tabindex="0" class="rowheaders">
                    <aura:if isTrue="{!v.data.length == 0}">
                        <div class="slds-p-around_small slds-align_absolute-center" role="banner">
                            <h3 class="slds-modal__title slds-hyphenate slds-text-heading--medium">
                                No lines found.
                            </h3>
                        </div>
                        <aura:set attribute="else">
                            <table aura:id="LineTable" class="customtable slds-table slds-table_cell-buffer slds-table_bordered slds-table_col-bordered">
                                <thead>
                                    <tr>
                                        <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                                            <th scope="col" class="slds-is-sortable slds-cell-wrap">
                                            </th>
                                        </aura:if>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByProductName}">
                                            <div class="slds-truncate" title="Product Name">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Product Name">Product Name</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'ProductName__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'ProductName__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByMaterialCode}">
                                            <div class="slds-truncate" title="Material Code">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Material Code">Material Code</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Material_Code__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Material_Code__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByNDC}">
                                            <div class="slds-truncate" title="NDC-11">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="NDC-11">NDC-11</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_NDC_11__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_NDC_11__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByOldPHS}">
                                            <div class="slds-truncate" title="Old PHS Price $">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Old PHS Price $">Old PHS Price $</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Old_PHS_Price__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Old_PHS_Price__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByNewPHS}">
                                            <div class="slds-truncate" title="New PHS Price $">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="New PHS Price $">New PHS Price $</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_New_PHS_Price__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_New_PHS_Price__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByChangeInPrice}">
                                            <div class="slds-truncate" title="% Change in Price">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="% Change in Price">% Change in Price</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Change_in_Price__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Change_in_Price__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByPHSUnits}">
                                            <div class="slds-truncate" title="Last 90days PHS Units">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Last 90days PHS Units">Last 90days PHS Units</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Last_90_days_PHS_Units__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Last_90_days_PHS_Units__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortBySalesDifference}">
                                            <div class="slds-truncate" title="Sales Difference $">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Sales Difference $">Sales Difference $</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Sales_Difference__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Sales_Difference__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByApexusPrice}">
                                            <div class="slds-truncate" title="Price in Apexus Sub-Ceiling Contract">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Price in Apexus Sub-Ceiling Contract">Price in Apexus Sub-Ceiling Contract</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Price_in_Apexus_Sub_Ceiling_Contract__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Price_in_Apexus_Sub_Ceiling_Contract__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByDiffApexusPrice}">
                                            <div class="slds-truncate" title="Diff in Apexus Sub-Ceiling Price">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Diff in Apexus Sub-Ceiling Price">Diff in Apexus Sub-Ceiling Price</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Diff_in_Apexus_Sub_Ceiling_Price__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Diff_in_Apexus_Sub_Ceiling_Price__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByApexusPriceChangeRequired}">
                                            <div class="slds-truncate" title="Apexus Sub-Ceiling Price Change Required">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Apexus Sub-Ceiling Price Change Required">Apexus Sub-Ceiling Price Change Required</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Apexus_Sub_Ceiling_Price_Change_Required__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Apexus_Sub_Ceiling_Price_Change_Required__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                        <th scope="col" class="slds-is-sortable slds-cell-wrap" onclick="{!c.sortByRemarks}">
                                            <div class="slds-truncate" title="Submitter Remarks">
                                                <a href="javascript:void(0);"
                                                   class="slds-th__action slds-text-link--reset">
                                                    <span class="slds-assistive-text">Sort</span>
                                                    <span class="slds-truncate" title="Remarks">Submitter Remarks</span>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection == 'arrowdown', v.sortField == 'Phoenix_Remarks__c') }">
                                                        &nbsp; &#9660; </aura:if>
                                                    <aura:if
                                                             isTrue="{! and(v.arrowDirection != 'arrowdown', v.sortField == 'Phoenix_Remarks__c') }">
                                                        &nbsp; &#9650; </aura:if>
                                                </a>
                                            </div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <aura:iteration items="{!v.data}" var="item" indexVar="index">
                                        <c:Phoenix_QuarterlyPHSPriceChild lineInstance="{!item}" rowIndex="{!index}" recordId="{!v.recordId}" ApprovalStatus="{!v.ApprovalStatus}" />
                                    </aura:iteration>
                                </tbody>
                            </table>
                        </aura:set>
                    </aura:if>
                </div>
            </div>
            <aura:if isTrue="{!v.showImportModal}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <!-- ###### MODAL BOX HEADER Start ######-->
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close"
                                                  onclick="{! c.closeModal }"
                                                  alternativeText="close"
                                                  variant="bare-inverse"
                                                  class="slds-modal__close"/>
                            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Upload Files</h2>
                        </header>
                        <!--###### MODAL BOX BODY Part Start######-->
                        <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                            <lightning:fileUpload label="Import"
                                                  variant="label-hidden"
                                                  name="fileUploader"
                                                  accept=".csv"
                                                  recordId="{!v.recordId}"
                                                  onuploadfinished="{!c.handleImport}" class="hideSpan" />
                        </div>
                        <!--###### MODAL BOX FOOTER Part Start ######-->
                        <footer class="slds-modal__footer">
                            <lightning:button variant="brand" label="Close"
                                              onclick="{!c.closeModal}" />
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>
            <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                <lightning:button label="First" iconName="utility:left" iconPosition="left"
                                  onclick="{!c.onFirst}" disabled="{! v.currentPageNumber == 1}"/>
                <lightning:button iconName="utility:chevronleft" iconPosition="left"
                                  onclick="{!c.onPrev}" disabled="{! v.currentPageNumber == 1}"/>
                <span class="slds-p-horizontal_x-small">
                    <a onclick="{!c.processMe}" name="1" 
                       class="{! (v.currentPageNumber == 1) ? 'selected' : ''}">1</a>
                </span>
                <span class="slds-p-horizontal_xxx-small">
                    <a>...</a>
                </span>
                
                <aura:iteration items="{!v.pageList}" var="item">
                    <span class="slds-p-horizontal_x-small">
                        <a onclick="{!c.processMe}" name="{!item}"
                           class="{! (v.currentPageNumber == item) ? 'selected' : ''}">{!item}</a>
                    </span>
                </aura:iteration>
                
                <span class="slds-p-horizontal_xxx-small">
                    <a>...</a>
                </span>
                <span class="slds-p-horizontal_x-small">
                    <a onclick="{!c.processMe}" name="{!v.totalPages}"
                       class="{! (v.currentPageNumber == v.totalPages) ? 'selected' : ''}">{!v.totalPages}</a>
                </span>
                <lightning:button iconName="utility:chevronright" iconPosition="right" 
                                  disabled="{! v.currentPageNumber == v.totalPages}" onclick="{!c.onNext}"/>
                <lightning:button label="Last" iconName="utility:right" iconPosition="right" 
                                  disabled="{! v.currentPageNumber == v.totalPages}" onclick="{!c.onLast}"/>
                <!--<lightning:button label="First" disabled="{!v.start == 0}"  onclick="{!c.first}" />
                <lightning:button label="Previous" disabled="{!v.start == 0}"  onclick="{!c.previous}" />
                <lightning:button label="Next" disabled="{!v.end >= (v.totalSize-1)}" onclick="{!c.next}" />
                <lightning:button label="Last" disabled="{!v.end >= (v.totalSize-1)}" onclick="{!c.last}" />-->
            </div>
            <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                <lightning:button class="slds-m-top_medium" variant="neutral" label="Back" onclick="{!c.backToRecordDetail}" />
                <lightning:button class="slds-m-top_medium" variant="brand" type="Button" label="Save" onclick="{!c.Save}" disabled="{!or(or(v.linesList.length == 0, v.ApprovalStatus != 'Draft'), v.disableSaveLines)}" />
                 <aura:if isTrue="{!and(and(v.ApprovalStatus=='Draft',v.linesList1.length > 0), v.disableSubmit)}">
                        <lightning:button class="slds-m-top_medium" label="Submit For Approval" variant="brand" onclick="{!c.openSubmitModal}" />
                    </aura:if>
                <lightning:button class="slds-m-top_medium" variant="neutral" type="Button" label="Export" onclick="{!c.downloadCsv}" disabled="{!v.disableExportImportBtn}" />
                <lightning:button class="slds-m-top_medium" variant="neutral" type="Button" label="Import" onclick="{!c.showImport}" disabled="{!or(v.disableExportImportBtn, v.ApprovalStatus != 'Draft')}" />
            </div>
            <div class="modal-footer slds-modal__footer slds-align_absolute-center" role="banner">
                <lightning:button class="slds-m-top_medium" variant="brand" type="Button" label="Attach File" onclick="{!c.showUploadFile}" />
            </div>
            <aura:if isTrue="{!v.fileUpload}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <!-- ###### MODAL BOX HEADER Start ######-->
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close"
                                                  onclick="{! c.closeModal }"
                                                  alternativeText="close"
                                                  variant="bare-inverse"
                                                  class="slds-modal__close"/>
                            <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Upload Files</h2>
                        </header>
                        <!--###### MODAL BOX BODY Part Start######-->
                        <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                            <lightning:fileUpload label=""
                                                  variant="label-hidden"
                                                  name="fileUploader"
                                                  multiple="true"
                                                  accept="{!v.filetype}"
                                                  recordId="{!v.recordId}"
                                                  disabled="{!v.ApprovalStatus != 'Draft'}"
                                                  onuploadfinished="{!c.handleUploadFinished}" class="hideSpan"/>
                            <b><h2 style="font-size:15px;padding-bottom:10px;">List of Attachments ({!v.fileList.length})</h2></b>
                            <div class="container desktop forceContentFilePicker" style="width: 100%; display: flex; background-color: var(--lwc-colorBackgroundAlt,rgb(255, 255, 255));">
                                <!--div class="slds-border_left" ></div-->
                                <div class="rightPanel" style="float:right;width:100%;overflow-y: visible;" >
                                    <div class="searchResultsContainer multiAttach"   style="overflow: auto; clear: both; padding-right: 0;">
                                        <ul style="list-style:none;padding-left:40px;margin:0px;">
                                            
                                            <aura:iteration items="{!v.fileList}" var="file" indexVar="itemIndex">
                                                <li class="slds-var-p-horizontal_medium slds-var-p-vertical_xx-small forceContentVirtualRelatedListStencil forceRecordLayout" style="{!if(itemIndex==(v.fileList.length-1),'border-top:var(--lwc-borderWidthThin,1px) solid var(--lwc-colorBorderSeparatorAlt,rgb(221, 219, 218));height: auto; margin: 0; padding: 0; list-style: none; font-weight: var(--lwc-fontWeightRegular,400); font-size: var(--lwc-fontSizeMedium,0.8125rem);border-bottom:1px solid #dddbda;','border-top:var(--lwc-borderWidthThin,1px) solid var(--lwc-colorBorderSeparatorAlt,rgb(221, 219, 218));height: auto; margin: 0; padding: 0; list-style: none; font-weight: var(--lwc-fontWeightRegular,400); font-size: var(--lwc-fontSizeMedium,0.8125rem);')}" >
                                                    <div class="filerow" style="padding: var(--lwc-spacingXxSmall,0.25rem) 0 var(--lwc-spacingXxSmall,0.25rem) var(--lwc-spacingMedium,1rem);display: flex; table-layout: fixed; width: 100%;padding-bottom:8px;">
                                                        <div class="slds-size_12-of-12 slds-grid slds-nowrap">
                                                            <p  data-name="{!file.Id}" style="cursor:pointer;">
                                                                <aura:if isTrue="{!v.ApprovalStatus == 'Draft'}">
                                                                    <a  name="{!file.Id}" onclick="{!c.deleteAttachment}" disabled="{!v.ApprovalStatus != 'Draft'}">
                                                                        <lightning:icon iconName="utility:delete" iconPosition="left" alternativeText="delete" size="x-small" />
                                                                    </a>
                                                                </aura:if>
                                                                <!-- <lightning:button class="customBIcon"
                                                                                          iconName="action:delete" iconPosition="left"
                                                                                          onclick="{!c.deleteAttachment }"
                                                                                          name="{!file.Id}"  />-->&nbsp; 
                                                                <a href="{!'/'+file.Id}"
                                                                   target="_blank"  >{!itemIndex+1}.&nbsp;{!file.Title} </a>   
                                                            </p>
                                                        </div>
                                                    </div>
                                                </li>
                                            </aura:iteration>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--###### MODAL BOX FOOTER Part Start ######-->
                        <footer class="slds-modal__footer">
                            <lightning:button variant="brand" label="Close"
                                              onclick="{!c.closeModal}" />
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>
        </lightning:card>
    </aura:if>
   
      <aura:if isTrue="{!v.showSubmitModal}">
                    <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                             aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                        <div class="slds-modal__container">
                            <header class="slds-modal__header">
                                <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                                    Submit PHS For Approval</h2>
                            </header>
                            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                <p>
                                    <div style="text-align:center;padding-bottom:3px;">Are you sure you want to submit
                                        this PHS Price Change for approval?</div>
                                </p>
                            </div>
                            <!--Modal/Popup Box Footer Starts here-->
                            <footer class="slds-modal__footer">
                                <lightning:button variant="neutral" label="No" title="No"
                                                  onclick="{! c.hideSubmitModel }" />
                                <lightning:button variant="brand" label="Yes" title="Yes"
                                                  onclick="{!c.proceedToSubmit}" />
                            </footer>
                        </div>
                    </section>
                    <div class="slds-backdrop slds-backdrop_open"></div>
                </aura:if>
</aura:component>