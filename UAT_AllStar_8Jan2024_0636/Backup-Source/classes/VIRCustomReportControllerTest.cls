@isTest(seeAllData=true)
public class VIRCustomReportControllerTest {
    static testmethod void VIRCustomerReportMethod(){
        Account acc = new Account();
        acc.Name = 'Test Account';
        acc.OwnerId = userInfo.getUserId();
        insert acc;
        Contact con=new Contact();
        con.LastName='Test';
        string last=con.LastName;
        con.AccountId=acc.Id;
        con.Influence_Score__c=1;
        con.Affinity_Score__c=2;
        con.Authority__c=3;
        con.Contact_Role__c='Management';
        insert con;
        Date d1 = date.newinstance(2022, 1, 1);
        Date d2 = date.newinstance(2022, 12, 31);
        Phoenix_Bid_VIP_Rebate__c vipRebate1 = new Phoenix_Bid_VIP_Rebate__c();
        vipRebate1.Name = 'TestRebate1';
        vipRebate1.Phoenix_Customer__c = acc.Id;
        vipRebate1.Phoenix_Type__c = 'Currency';
        vipRebate1.Phoenix_Start_Date__c = d1;
        vipRebate1.Phoenix_End_Date__c = d2;
        vipRebate1.Phoenix_Status__c = 'Current';
        vipRebate1.Net_Contract__c = 'Net';
        vipRebate1.Payment_Frequency__c = 'Annual';
        vipRebate1.Vistex_Agreement__c = '345435254';
        insert vipRebate1;
        Phoenix_Bid_VIP_Rebate__c vipRebate2 = new Phoenix_Bid_VIP_Rebate__c();
        vipRebate2.Name = 'TestRebate2';
        vipRebate2.Phoenix_Customer__c = acc.Id;
        vipRebate2.Phoenix_Type__c = 'Currency';
        vipRebate2.Phoenix_Start_Date__c = d1;
        vipRebate2.Phoenix_End_Date__c = d2;
        vipRebate2.Phoenix_Status__c = 'Current';
        vipRebate2.Net_Contract__c = 'Net';
        vipRebate2.Payment_Frequency__c = 'Quarterly';
        vipRebate2.Vistex_Agreement__c = '345435453';
        insert vipRebate2;
        Phoenix_Bid_VIP_Rebate__c vipRebate3 = new Phoenix_Bid_VIP_Rebate__c();
        vipRebate3.Name = 'TestRebate3';
        vipRebate3.Phoenix_Customer__c = acc.Id;
        vipRebate3.Phoenix_Type__c = 'Currency';
        vipRebate3.Phoenix_Start_Date__c = d1;
        vipRebate3.Phoenix_End_Date__c = d2;
        vipRebate3.Phoenix_Status__c = 'Current';
        vipRebate3.Net_Contract__c = 'Net';
        vipRebate3.Payment_Frequency__c = '6 Months';
        vipRebate3.Vistex_Agreement__c = '345675763';
        insert vipRebate3;
        List<Phoenix_Bid_VIP_Rebate__c> vipRebateData = new List<Phoenix_Bid_VIP_Rebate__c>();
        vipRebateData.add(vipRebate1);
        vipRebateData.add(vipRebate2);
        vipRebateData.add(vipRebate3);
        Integer dollarVal1 = 324324554;
        Phoenix_VIP_Rebate_Line__c vipRebateLine1 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine1.Name = 'TestRebateLine1';
        vipRebateLine1.Phoenix_Tier__c = '1';
        vipRebateLine1.Phoenix_Dollar_Value_From__c = dollarVal1;
        vipRebateLine1.Phoenix_Dollar_Value_To__c = dollarVal1+12011210;
        vipRebateLine1.Phoenix_Discount_Rebate__c = 76;
        vipRebateLine1.Phoenix_VIP_Rebate__c = vipRebate1.Id;
        insert vipRebateLine1;
        
        Phoenix_VIP_Rebate_Line__c vipRebateLine2 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine2.Name = 'TestRebateLine2';
        vipRebateLine2.Phoenix_Tier__c = '2';
        vipRebateLine2.Phoenix_Dollar_Value_From__c = dollarVal1;
        vipRebateLine2.Phoenix_Dollar_Value_To__c = dollarVal1+12301210;
        vipRebateLine2.Phoenix_Discount_Rebate__c = 67;
        vipRebateLine2.Phoenix_VIP_Rebate__c = vipRebate1.Id;
        insert vipRebateLine2;
        
        Integer dollarVal2 = 324358454;
        Phoenix_VIP_Rebate_Line__c vipRebateLine3 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine3.Name = 'TestRebateLine3';
        vipRebateLine3.Phoenix_Tier__c = '1';
        vipRebateLine3.Phoenix_Dollar_Value_From__c = dollarVal2;
        vipRebateLine3.Phoenix_Dollar_Value_To__c = dollarVal2+1230981;
        vipRebateLine3.Phoenix_Discount_Rebate__c = 76;
        vipRebateLine3.Phoenix_VIP_Rebate__c = vipRebate2.Id;
        insert vipRebateLine3;
        
        Phoenix_VIP_Rebate_Line__c vipRebateLine4 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine4.Name = 'TestRebateLine4';
        vipRebateLine4.Phoenix_Tier__c = '2';
        vipRebateLine4.Phoenix_Dollar_Value_From__c = dollarVal2;
        vipRebateLine4.Phoenix_Dollar_Value_To__c = dollarVal2+1237981;
        vipRebateLine4.Phoenix_Discount_Rebate__c = 10;
        vipRebateLine4.Phoenix_VIP_Rebate__c = vipRebate2.Id;
        insert vipRebateLine4;
        
        Integer dollarVal3 = 32435854;
        Phoenix_VIP_Rebate_Line__c vipRebateLine5 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine5.Name = 'TestRebateLine4';
        vipRebateLine5.Phoenix_Tier__c = '1';
        vipRebateLine5.Phoenix_Dollar_Value_From__c = dollarVal2;
        vipRebateLine5.Phoenix_Dollar_Value_To__c = dollarVal2+1250981;
        vipRebateLine5.Phoenix_Discount_Rebate__c = 20;
        vipRebateLine5.Phoenix_VIP_Rebate__c = vipRebate3.Id;
        insert vipRebateLine5;
        
        Phoenix_VIP_Rebate_Line__c vipRebateLine6 = new Phoenix_VIP_Rebate_Line__c();
        vipRebateLine6.Name = 'TestRebateLine5';
        vipRebateLine6.Phoenix_Tier__c = '2';
        vipRebateLine6.Phoenix_Dollar_Value_From__c = dollarVal2;
        vipRebateLine6.Phoenix_Dollar_Value_To__c = dollarVal2+1237981;
        vipRebateLine6.Phoenix_Discount_Rebate__c = 15;
        vipRebateLine6.Phoenix_VIP_Rebate__c = vipRebate3.Id;
        insert vipRebateLine6;
        List<Phoenix_VIP_Rebate_Line__c> rebateLinesData = new List<Phoenix_VIP_Rebate_Line__c>();
        rebateLinesData.add(vipRebateLine1);
        rebateLinesData.add(vipRebateLine2);
        rebateLinesData.add(vipRebateLine3);
        rebateLinesData.add(vipRebateLine4);
        rebateLinesData.add(vipRebateLine5);
        rebateLinesData.add(vipRebateLine6);
        Vision_DRL_Sales__c sales= new Vision_DRL_Sales__c();
        sales.Vision_Customer_Name__c = acc.Id;
        sales.Vision_Sales_Dollar__c =123.45;
        sales.Vision_Units__c = 500;
        sales.Vision_Segment__c = 'Rx';
        sales.Vision_TPT_Dollar__c = 234;
        sales.Vision_TPT_Pct__c = 10;
        sales.Vision_Month_dtls__c = system.today()-365;
        insert sales;
        Vision_DRL_Sales__c sales2= new Vision_DRL_Sales__c();
        sales2.Vision_Customer_Name__c = acc.Id;
        sales2.Vision_Sales_Dollar__c =123.45;
        sales2.Vision_Units__c = 500;
        sales2.Vision_Segment__c = 'Rx';
        sales2.Vision_TPT_Dollar__c = 234;
        sales2.Vision_TPT_Pct__c = 10;
        sales2.Vision_Month_dtls__c = system.today()-365;
        insert sales2;
        Vision_DRL_Sales__c sales1= new Vision_DRL_Sales__c();
        sales1.Vision_Customer_Name__c = acc.Id;
        sales1.Vision_Sales_Dollar__c =123.45;
        sales1.Vision_Units__c = 500;
        sales1.Vision_Segment__c = 'SRx';
        sales1.Vision_TPT_Dollar__c = 234;
        sales1.Vision_TPT_Pct__c = 10;
        sales1.Vision_Month_dtls__c = system.today()-200;
        insert sales1;
        
        Vision_DRL_Sales__c testRec = new Vision_DRL_Sales__c();
        testRec.Vision_Customer_Name__c = acc.Id;
        testRec.Vision_Sales_Dollar__c =123.45;
        testRec.Vision_Units__c = 500;
        testRec.Vision_Segment__c = 'OTC';
        testRec.Vision_TPT_Dollar__c = 234;
        testRec.Vision_TPT_Pct__c = 10;
        testRec.Vision_Month_dtls__c = system.today()-30;
        insert testRec;
        
        GCP_VIR_Report__c testVIR1= new GCP_VIR_Report__c();
        testVIR1.Vision_Account__c=acc.Id;
        testVIR1.Vision_GCP_Month__c=1;
        testVIR1.Vision_GCP_Month_Text__c='Jan';
        testVIR1.Vision_GCP_Start_Date__c= d1.addMonths(1);
        testVIR1.Vision_GCP_End_Date__c=d2.addMonths(-1);
        testVIR1.Vision_Agreement_Number__c = '345435453';
        testVIR1.Vision_Data_Available_Till__c = string.valueOf(system.today());
        insert testVIR1;
        
        GCP_VIR_Report__c testVIR2= new GCP_VIR_Report__c();
        testVIR2.Vision_Account__c=acc.Id;
        testVIR2.Vision_GCP_Month__c=2;
        testVIR2.Vision_GCP_Month_Text__c='Feb';
        testVIR2.Vision_GCP_Start_Date__c=d1.addMonths(1);
        testVIR2.Vision_GCP_End_Date__c=d2.addMonths(-1);
        testVIR2.Vision_Agreement_Number__c = '345435254';
        testVIR2.Vision_Data_Available_Till__c = string.valueOf(system.today());
        insert testVIR2;
        System.debug('testVIR1>>>'+testVIR1);
        List<GCP_VIR_Report__c> testVIRReportList=new List<GCP_VIR_Report__c>();
        testVIRReportList.add(testVIR1);
        String nullId = '';
        Phoenix_Bid__c bidtest = new  Phoenix_Bid__c();
        bidtest.Phoenix_Bid_Type__c='Product Addition';
        bidtest.Phoenix_Customer_Type__c = 'Net Indirect Pricing';
        bidtest.Phoenix_Approval_Status__c='Closed';
        bidtest.Phoenix_Customer__c=acc.Id;
        insert bidtest;
        Phoenix_Customer_Response__c custResponse1 = new Phoenix_Customer_Response__c();
        custResponse1.Phoenix_Bid_No__c = bidtest.Id;
        custResponse1.Phoenix_Customer_Response_Date__c = Date.newInstance(2022,06,06);
        insert custResponse1;
        Phoenix_Customer_Response_Line__c testCuRes= new Phoenix_Customer_Response_Line__c();
        testCuRes.Phoenix_Bid__c=bidtest.Id;
        testCuRes.Phoenix_Customer_Response__c = custResponse1.Id;
        testCuRes.Phoenix_Supply_Effective_Date__c=d1;
        testCuRes.Phoenix_Price_Effective_Date__c=d1;
        insert testCuRes;
        Phoenix_Bid_Line_Item__c bdl= new Phoenix_Bid_Line_Item__c();
        bdl.Phoenix_Bid_Status__c='Awarded';
        bdl.Phoenix_DeadNet_TrckGR__c=1;
        bdl.Phoenix_Bid__c=bidtest.Id;
        bdl.Phoenix_Customer_Response_Line__c=testCuRes.Id;
        bdl.Phoenix_Bid_Line_Type__c='Product Addition';
        bdl.Phoenix_Price_Effective_Date__c=d1;
        
        insert bdl;
        Phoenix_BidLineItemExtn__c bidExtnObj0 = new Phoenix_BidLineItemExtn__c();
        bidExtnObj0.Phoenix_Bid_Line_Item__c = bdl.Id;
        bidExtnObj0.Vision_Effective_Date_of_Removal__c = '10/10/2022';
        insert bidExtnObj0;
        
        Phoenix_Bid__c bidtest1 = new  Phoenix_Bid__c();
        bidtest1.Phoenix_Approval_Status__c='Closed';
        bidtest1.Phoenix_Bid_Type__c='Product Discontinuation Process';
        bidtest1.Phoenix_Customer__c=acc.Id;
        insert bidtest1;
        Phoenix_Bid_Line_Item__c bdl1= new Phoenix_Bid_Line_Item__c();
        bdl1.Phoenix_DeadNet_TrckGR__c=1;
        bdl1.Phoenix_Bid__c=bidtest1.Id;
        bdl1.Phoenix_Final_Status__c ='Approved';
        bdl1.Phoenix_Bid_Line_Item_Approval_Status__c='Closed-Contracts';
        
        insert bdl1;
        Phoenix_BidLineItemExtn__c bidExtnObj1 = new Phoenix_BidLineItemExtn__c();
        bidExtnObj1.Phoenix_Bid_Line_Item__c = bdl1.Id;
        bidExtnObj1.Vision_Effective_Date_of_Removal__c = '10/10/2022';
        insert bidExtnObj1;

        Phoenix_Bid__c bidtest2 = new  Phoenix_Bid__c();
        bidtest2.Phoenix_Approval_Status__c='Closed';
        bidtest2.Phoenix_Bid_Type__c='Mass Product Removals';
        bidtest2.Phoenix_Customer__c=acc.Id;
        insert bidtest2;
        Phoenix_Bid_Line_Item__c bdl2= new Phoenix_Bid_Line_Item__c();
        bdl2.Phoenix_DeadNet_TrckGR__c=1;
        bdl2.Phoenix_Bid__c=bidtest2.Id;
        bdl2.Phoenix_Final_Status__c ='Approved';
        bdl2.Phoenix_Bid_Line_Item_Approval_Status__c='Closed-Contracts';
        
        insert bdl2;
        Phoenix_BidLineItemExtn__c bidExtnObj2 = new Phoenix_BidLineItemExtn__c();
        bidExtnObj2.Phoenix_Bid_Line_Item__c = bdl2.Id;
        bidExtnObj2.Vision_Effective_Date_of_Removal__c = '11/10/2022';
        insert bidExtnObj2;
        
        
        List<Phoenix_Bid_Line_Item__c> bidLineList= new List<Phoenix_Bid_Line_Item__c>();
        bidLineList.add(bdl);
        bidLineList.add(bdl1);
        System.debug('bidLineList>>>'+bidLineList);
        VIRCustomReportControllerCls.Wrapper wrap = new VIRCustomReportControllerCls.Wrapper();
        List<Phoenix_Bid_VIP_Rebate__c> vipRebateDataSingle = new List<Phoenix_Bid_VIP_Rebate__c>();
        vipRebateDataSingle.add(vipRebateData[0]);
        wrap.vipRebateData = vipRebateData;
        wrap.vipRebateDataSingle = vipRebateDataSingle;
        wrap.rebateLinesData = rebateLinesData;
        wrap.monthYearSet = wrap.monthYearSet;
        wrap.listOfFinalRecords = wrap.listOfFinalRecords;
        wrap.listOfLastYearRecords = wrap.listOfLastYearRecords;
        
        List<String> classList = new List<String>{'testBatch1'};
            VIRCustomReportControllerCls.getVIPRebateData(acc.Id, vipRebate1.Id);
        VIRCustomReportControllerCls.getVIPRebateLinesData(acc.Id, vipRebate1.Id);
        VIRCustomReportControllerCls.getVIPRebateData(acc.Id, vipRebate1.Id);
        VIRCustomReportControllerCls.getVIPRebateData(acc.Id, vipRebate1.Id);
        VIRCustomReportControllerCls.getVIPRebateData(acc.Id, null);
        //Date d1=Date.parse('01/01/2021');
        //Date d2=Date.parse('12/31/2021');
        VIRCustomReportControllerCls.getTableData(acc.Id, vipRebate1.Id, vipRebate1.Vistex_Agreement__c, d1,d2);
        VIRCustomReportControllerCls.apexJobStatus(classList);
        VIRCustomReportControllerCls.runVIR();
    }
    
}